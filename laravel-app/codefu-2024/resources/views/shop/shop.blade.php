<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp,container-queries"></script>
    <meta name="csrf-token" content="{{ csrf_token() }}">
  </head>
  <body>
    <div class="flex items-center justify-center h-[100vh]">
    <div class="w-[80%] mt-14 mx-auto">
      <div class="flex justify-between">
        <div>
          <a href="">
            <svg width="43" height="43" viewBox="0 0 43 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-[35px] h-[35px]"preserveAspectRatio="none">
              <g filter="url(#filter0_d_147_270)">
                <rect x="4" width="35" height="35" rx="8" fill="#D9D9D9"></rect>
              </g>
              <path
                d="M31.917 25.0473L27.901 17.6053C28.3107 16.6735 28.5399 15.644 28.5399 14.5603C28.5399 10.3847 25.1622 7 20.9953 7C16.8277 7 13.45 10.3854 13.45 14.5603C13.45 15.6702 13.6909 16.723 14.1184 17.6713L10.0846 25.0438C9.95424 25.2811 9.9762 25.5733 10.1388 25.7893C10.3015 26.0052 10.5767 26.1063 10.8402 26.0444L14.2845 25.2529L15.4635 28.5434C15.5554 28.7992 15.7887 28.9766 16.0584 28.9966C16.0756 28.9979 16.0927 28.9986 16.1092 28.9986C16.3604 28.9986 16.5937 28.8604 16.7138 28.6362L20.2247 22.0827C20.4779 22.1088 20.7352 22.1219 20.9953 22.1219C21.2334 22.1219 21.4688 22.1095 21.7015 22.0875L25.2885 28.6424C25.41 28.8645 25.6412 29 25.8903 29C25.9082 29 25.926 28.9993 25.9439 28.9979C26.2129 28.9759 26.4448 28.7992 26.5361 28.5448L27.7151 25.2543L31.1601 26.0458C31.4243 26.1097 31.6967 26.0066 31.86 25.792C32.0234 25.5775 32.0453 25.2866 31.9177 25.0486L31.917 25.0473ZM16.2348 26.6241L15.3715 24.2138C15.2535 23.8858 14.911 23.6953 14.572 23.7758L12.0247 24.3617L14.9282 19.0542C15.8841 20.3491 17.2429 21.3256 18.8192 21.8008L16.2348 26.6241ZM14.8287 14.5603C14.8287 11.1529 17.5956 8.38085 20.9953 8.38085C24.395 8.38085 27.1613 11.1529 27.1613 14.5603C27.1613 17.9677 24.395 20.7397 20.9946 20.7397C17.5943 20.7397 14.8287 17.967 14.8287 14.5603ZM27.4282 23.7758C27.0878 23.6953 26.7468 23.8858 26.6287 24.2131L25.7593 26.6406L23.1179 21.8152C24.7354 21.34 26.1278 20.3381 27.0961 19.0061L29.9879 24.3637L27.4282 23.7758Z"
                fill="black"
                fill-opacity="0.53"
              ></path>
              <path
                d="M22.465 13.8073C22.9788 13.9573 23.3631 14.1566 23.6179 14.4051C23.8726 14.6489 24 14.9677 24 15.3615C24 15.6756 23.9093 15.9569 23.728 16.2053C23.5466 16.4538 23.2789 16.6484 22.9249 16.789C22.5751 16.9297 22.1498 17 21.649 17C21.0574 17 20.535 16.918 20.0816 16.7539C19.6326 16.5851 19.2807 16.3812 19.0259 16.1421L19.2396 15.8256C19.4642 16.0178 19.747 16.1819 20.0881 16.3179C20.4292 16.4538 20.7962 16.5218 21.1891 16.5218C21.4439 16.5218 21.636 16.482 21.7655 16.4023C21.8994 16.3226 21.9663 16.21 21.9663 16.0647C21.9663 15.8115 21.7353 15.6146 21.2733 15.474L20.4313 15.2068C19.9737 15.0567 19.6196 14.8481 19.3692 14.5809C19.1231 14.3136 19 13.9972 19 13.6315C19 13.3268 19.0885 13.0502 19.2655 12.8017C19.4426 12.5532 19.6995 12.3586 20.0363 12.218C20.3774 12.0727 20.7854 12 21.2604 12C21.7137 12 22.1304 12.0563 22.5104 12.1688C22.8946 12.2813 23.2077 12.4173 23.4495 12.5767L23.2358 12.9001C23.0328 12.7736 22.7889 12.6657 22.5039 12.5767C22.2232 12.4876 21.9275 12.443 21.6166 12.443C21.3446 12.443 21.1351 12.4899 20.9883 12.5837C20.8459 12.6728 20.7746 12.797 20.7746 12.9564C20.7746 13.0783 20.8286 13.1861 20.9365 13.2799C21.0445 13.369 21.2496 13.458 21.5518 13.5471L22.465 13.8073Z"
                fill="#626262"
              ></path>
              <defs>
                <filter
                  id="filter0_d_147_270"
                  x="0"
                  y="0"
                  width="43"
                  height="43"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood
                    flood-opacity="0"
                    result="BackgroundImageFix"
                  ></feFlood>
                  <feColorMatrix
                    in="SourceAlpha"
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                    result="hardAlpha"
                  ></feColorMatrix>
                  <feOffset dy="4"></feOffset>
                  <feGaussianBlur stdDeviation="2"></feGaussianBlur>
                  <feComposite in2="hardAlpha" operator="out"></feComposite>
                  <feColorMatrix
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
                  ></feColorMatrix>
                  <feBlend
                    mode="normal"
                    in2="BackgroundImageFix"
                    result="effect1_dropShadow_147_270"
                  ></feBlend>
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="effect1_dropShadow_147_270"
                    result="shape"
                  ></feBlend>
                </filter>
              </defs>
            </svg>
          </a>
        </div>

        <div>
          <div class="flex flex-row gap-1">
            <span class="font-bold">67</span>
            <img src="{{asset('/images/coin_image/Group 57.png')}}" alt="" />
          </div>
        </div>
      </div>

      <div class="h-[493px] bg-[#D9D9D9] rounded-[14px]">
        <div id="category-buttons" class="justify-between flex flex-row gap-[10px] pt-[10px] px-[8px] overflow-x-scroll	">
          
        @foreach ($categories as $category)
            <div id="button-{{$category->id}}" class="flex"> <!--hidden-->
                <button onclick="switchCategory({{ json_encode($category) }}, 'button-{{$category->id}}')">
                    <p class="text-base font-light text-center text-[#9d9d9d]">{{$category->name}}</p>
                </button>
            </div>            
        @endforeach
        
        <div id="button-owned" class="flex"> <!--hidden-->
            <button onclick="switchCategory(ownedItems, 'button-owned')">
                <p class="text-base font-light text-center text-[#9d9d9d]">Owned</p>
            </button>
        </div>
        
          
          
          <div>

            </div>
            
        </div>
      
        <div class="flex flex-row justify-center mt-[7px]">
          <p id="category-title" class="text-[22px] font-light text-[#797979]">Specials</p>
        </div>
      
        <div class="mt-[23px] overflow-y-scroll h-[350px]">
          <div id="category-content" class="grid grid-cols-3 gap-4 px-[14px]">
            <div class="items-center place-items-center">
              <div class="rounded-[11px] bg-transparent border border-[#797272]  w-[60px] h-[60px]">
                <img src="./specials.png" alt="" class="">
              </div>
              <p class="text-[18px] font-bold text-left text-black/40">Special 1</p>
              <p class="text-[10px] text-semibold text-center text-black/40">You’ve got all specials</p>
            </div>
          </div>
        </div>
      </div>
      

<script>
    var ownedItems = {
        name: 'Owned',
        items: @json($ownedItems) // Convert PHP array to JavaScript object
    };
    console.log(ownedItems);

    let lastVisibleButtonId = 'button-specials';

    function switchCategory(categoryOrItems, buttonId) {
        let title, imageSrc, description, items;

        if (categoryOrItems.items) {
            // This is the ownedItems object
            title = categoryOrItems.name;
            imageSrc = './';  // Default or category-specific image
            description = 'You own these items';
            items = categoryOrItems.items;  // Access the items property directly
        } else {
            // This is a category
            title = categoryOrItems.name;
            imageSrc = './';
            description = 'You’ve got all ' + categoryOrItems.name;
            items = categoryOrItems.items; // Get items from the category
        }

        // Update content
        updateContent(title, imageSrc, items, description, categoryOrItems);

        // Hide and show buttons
        if (lastVisibleButtonId) {
            document.getElementById(lastVisibleButtonId).classList.remove('hidden');
        }

        document.getElementById(buttonId).classList.add('hidden');

        lastVisibleButtonId = buttonId;
    }


    function updateContent(title, imageSrc, items, description, category) {
        document.getElementById('category-title').textContent = title;

        // Update all items dynamically
        const content = document.getElementById('category-content');
        content.innerHTML = ''; // Clear existing content

        // Add the items dynamically (assuming each category has at least one item)
        items.forEach((item, index) => {
            const itemElement = document.createElement('div');

            
            const isActive = item.pivot && item.pivot.active === 1 ? true : false;

            itemElement.innerHTML = `
            <form action="/buy-item" method="POST" id="form-${item.id}">
                @csrf
                <input type="hidden" name="item_id" value="${item.id}">

                <div class="${isActive ? 'border-green-500' : ''} relative rounded-[11px] bg-transparent border border-[#797272] p-[8px] w-[60px] h-[60px] flex items-center place-items-center place-content-center justify-center" onclick="submitForm(${item.id})">
                    <img src="/images/smoggy/${imageSrc}${item.image}" alt="${item.name}" class="object-cover">                    
                </div>

                <p class="text-[15px] font-bold text-black/40">${item.name}</p>
                <div class="px-[5px] w-[60px] flex flex-row gap-[19px] place-items-center place-content-center justify-center">
                    <p class="text-[10px] text-center text-semibold text-black/40">${category.name}</p>
                    <div class="p-[2px]">
                        <div class="flex flex-row gap-[3px] rounded-sm bg-transparent border-[0.3px] border-[#626262] px-[9px] py-[3px] place-items-center place-content-center justify-center">
                            <p class="text-[7px] font-light text-[#626262]">${item.points}</p>
                            <img src="/images/coin_image/Group 57.png" alt="" class="w-[10px] h-[10px]">
                            </div>
                    </div>
                </div>
            </form>
            `;
            

            content.appendChild(itemElement);
        });
    }


function submitForm(itemId) {
    const form = document.getElementById(`form-${itemId}`);
    form.submit();  // Submit the form
}


function purchaseItem(itemId) {
    // Send a request to the server to buy the item
    fetch('/buy-item', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content') // For CSRF protection
        },
        body: JSON.stringify({ item_id: itemId }) // Send the item ID to the server
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Item successfully purchased!');
        } else {
            alert('Failed to purchase item. ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error purchasing item:', error);
        alert('There was an error processing your purchase.');
    });
}

// Default content initialization (Specials)
updateContent('Specials', './specials.png', [], 'You’ve got all specials');

      </script>

      {{-- <script>
        let lastVisibleButtonId = 'button-specials';
      
        function switchCategory(title, imageSrc, name, description, buttonId) {
          
          updateContent(title, imageSrc, name, description);
      
          if (lastVisibleButtonId) {
            document.getElementById(lastVisibleButtonId).classList.remove('hidden');
          }

          document.getElementById(buttonId).classList.add('hidden');
      
          lastVisibleButtonId = buttonId;
        }
    
          function updateContent(title, imageSrc, name, description) {
              document.getElementById('category-title').textContent = title;

            // Update all items dynamically
            const content = document.getElementById('category-content');
            content.innerHTML = ''; // Clear existing content

            // Add new items (12 total for 4 rows x 3 columns)
            for (let i = 1; i <= 12; i++) {
                const item = document.createElement('div');

                // Item content
                item.innerHTML = `
                <div class="rounded-[11px] bg-transparent border border-[#797272] p-[8px] w-[60px] h-[60px] flex items-center place-items-center place-content-center justify-center">
                    <img src="${imageSrc}" alt="" class="">
                </div>
                <div class="mt-[3px] flex flex-row gap-[3px]">
                    <div class="rounded-full bg-[#FFD700] w-[8px] h-[8px]"></div>
                    <div class="rounded-full bg-[#FFD700] w-[8px] h-[8px]"></div>
                    <div class="rounded-full bg-[#FFD700] w-[8px] h-[8px]"></div>
                </div>
                <p class="text-[15px] font-bold text-black/40">${name} ${i}</p>
                <div class="w-[70px] flex flex-row gap-[19px] place-items-center place-content-center justify-center">
                    <p class="text-[10px] text-center text-semibold text-black/40">Test</p>
                    <div class="p-[2px]">
                    <div class="flex flex-row gap-[3px] rounded-sm bg-transparent border-[0.3px] border-[#626262] px-[9px] py-[3px] place-items-center place-content-center justify-center">
                        <p class="text-[7px] font-light text-[#626262]">25</p>
                        <img src="./coin-spng.png" alt="" class="w-[10px] h-[10px]">
                    </div>
                    </div>
                </div>
                `;
                content.appendChild(item);
            }
            }
      
        // Default content initialization (Specials)
        updateContent('Specials', './specials.png', 'Special', 'You’ve got all specials');
      </script> --}}
      
      <style>
        .hidden {
          display: none;
        }
      </style>
      
    </body>
</html>